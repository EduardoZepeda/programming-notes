## 1.21 Otras buenas prácticas

Básicamente el problema es de bloqueo de tabla, cuando una consulta tipo borrado
se debe ejecutar, le avisa al motor de base de datos su objetivo y este debe
detener todas las consultasy otras modificaciones a la tabla hasta que el
proceso termine, pero como la cantidad de inserciones es alta, la consulta de
borrado se queda esperando a que el motor le dé el turno de trabajar o peor
aún,si le llega a entregar el turno, el proceso de borrado puede llegar a tardar
minutos en el que ninguna inserción puede ser ejecutada, lo que causa
encolamiento de peticiones hasta que se desborda la capacidad del servidor.

Se tratará de crear una tabla con la misma estructura y alternar renombrandolas
para que cuando se ejecute

El servidor que recibe los datos de todos los dispositivos IoT y los procesa
debe tener una lógica que se ejecuta cada minuto o menos y es algo así

``` sql
Consultar estadística;
Si está con datos, procesar mil datos y borrar lo procesado;
Si está vacía, no hacer nada;
```

Pero ésta lógica nunca va a lograr vaciar la tabla ya que llegan más datos por
minuto de los que puede procesar. Por lo tanto, se debe agregar una tarea para
poder usar el renombramiento de tablas como un potencializador del rendimiento
así

``` sql
Consultar estadistica_offload;
Si está con datos, procesar mil datos y borrar lo procesado;
Si está vacía, renombra tablas;
```

La idea es hacer la consulta sobre la tabla estadistica_offload que NO está
siendo “bombardeada” de datos, lo que permite que la lectura y modificación de
datos sea mucho más rápida que la tabla estadistica.

``` sql
BEGIN TRANSACTION ;ALTER TABLE estadistica RENAME TO estadistica_temp;
ALTER TABLE estadistica_offload RENAME TO estadistica;
ALTER TABLE estadistica_temp RENAME TO estadistica_offload;
COMMIT;
```


## 1.5 El sitio de administración

La interfaz de administración es solo parte de django.contrib. El cual
contiene muchas herramientas más. Esta esta activida por defecto si el
proyecto se inicio con \"startproject\". La interfaz puede activarse o
desactivarse de acuerdo a las necesidades del proyecto. Agrega
\'django.contrib.admin\' a la variable INSTALLED_APPS. Si quieres que
django cargue tus plantillas debes ponerlas antes de
django.contrib.admin Asegurate que estos 4 modulos se encuentren en
INSTALLED_APPS, pues son dependencias de django.contrib.admin

``` python
django.contrib.auth
django.contrib.contenttypes
django.contrib.messages
django.contrib.sessions
```

Agrega *django.contrib.messages.context_processors.messages* a la opción
de context_processors en la variable TEMPLATES de tu archivo
*settings.py* así como también agrega
*django.contrib.auth.middleware.AuthenticationMiddleware* y
*django.contrib.messages.middleware.MessageMiddleware* a la variable
MIDDLEWARE también de tu archivo *settings.py*.

Determina que modelos de tus aplicaciones serán editables en la interfaz
administrativa. No todos los modelos pueden (o deberían) ser editables
por los usuarios administradores. Por cada uno de los modelos, crea
opcionalmente una clase **ModelAdmin** en el archivo *admin.py* Apunta
la instancia AdminSite a tu URLconf Para cambiar el lenguaje en la
interfaz administrativa módifica la variable LANGUAGE_CODE al archivo
settings.py.

``` python
LANGUAGE_CODE = 'es-mx'
```

### 1.5.1 Agrega tus modelos al sitio administrativo

Agrega lo siguiente al archivo *admin.py* de tu aplicación. Django busca
en cada elemento de la variable INSTALLED_APPS un archivo *admin.py* y
agrega cada modelo en admin.site.register(modelo) a la interfaz.

``` python
from django.contrib import admin
from biblioteca.models import Editor, Autor, Libro

admin.site.register(Editor)
admin.site.register(Autor)
admin.site.register(Libro)
```

Para modificar el plural que aparece en el sitio agrega la variable
verbose_name_plural a la clase Meta en los modelos

``` python
verbose_name_plural = 'Autores'
```

### 1.5.2 Como crear campos opcionales

Para especificar un campo opcional agrega la variable blank = True al
campo que desees volver opcional.

``` {.python
class Autor(models.Model):
nombre = models.CharField(max_length=30)
apellidos = models.CharField(max_length=40)
email = models.EmailField(blank = True)}
```

Si quieres permitir agregar valores en blanco a un campo (DateField,
TimeField, DateTimeField o númerico (IntegerField, DecimalField),
FloatField) necesitas agregar null = True y blank = True. Recuerda usar
los comandos makemigrate y migrate para aplicar los cambios.

### 1.5.3 Personalizar las etiquetas de los campos

Para modificar las etiquetas de cada campo en la interfaz agrega la
variable verbose_name al campo del modelo a modificar.

``` python
class Autor(models.Model):
  nombre = models.CharField(max_length=30)
  apellidos = models.CharField(max_length=40)
  email = models.EmailField(blank=True, verbose_name='e-mail')# Verbose_name es un argumento posicional, por lo que puedes pasarlo al principio solo como 'e-mail' Sin embargo no trabaja con campos ManyToManyField o ForeignKey
```

### 1.5.4 Clases personalizadas de la interfaz administrativa

#### 1.5.4.1 Personalizar la lista de cambios

Por omisión la interfaz administrativa solo muestra los valores en la
función. \_\_[str]()\_ se cambiará de la sig. manera: Creamos la clase
AutorAdmin. Esta clase, la cual es una subclase de
django.contrib.admin.ModelAdmin, se encarga de llevar a cabo la
configuración para un modelo especifico de la interfaz administrativa.
Alteramos la llamada a admin.site.register(), para agregar AutorAdmin
después de Autor. La función admin.site.register() toma un subclase
ModelAdmin como un segundo argumento opcional para de ahí tomar sus
opciones

``` python
from django.contrib import admin
from biblioteca.models import Editor, Autor, Libro
class AutorAdmin(admin.ModelAdmin):
    list_display = ('nombre', 'apellidos', 'email') #Ahora la interfaz mostrará nombre, apellido y email de cada autor.
    search_fields = ('nombre', 'apellidos') #Muestra un campo de busqueda
class LibroAdmin(admin.ModelAdmin):
    list_display = ('titulo', 'editor', 'fecha_publicacion')
    list_filter = ('fecha_publicacion',)
    date_hierarchy = 'fecha_publicacion' #Agregará una barra de navegación por fechas
    ordering = ('-fecha_publicacion',)# Cambia el ordenamiento por omisión
admin.site.register(Editor)
admin.site.register(Autor, AutorAdmin)
admin.site.register(Libro)
```

#### 1.5.4.2 Personalizar formularios de edición

La variable Fields cambia el orden en el que aparecen los campos en la
sección modificar, incluso puede desaparecer la opción de modificar si
se omite un valor

``` python
class LibroAdmin(admin.ModelAdmin):
  list_display = ('titulo', 'editor', 'fecha_publicacion')
  list_filter = ('fecha_publicacion',)
  date_hierarchy = 'fecha_publicacion'
  ordering = ('-fecha_publicacion',)
  fields = ('titulo', 'autores', 'editor', 'fecha_publicacion')
```

Para campos many-to-many de más de 10 objetos se recomienda usar la
variable filter_horizontal (o filter_vertical), vuelve el manejo mucho
más sencillo

``` python
class LibroAdmin(admin.ModelAdmin):
  list_display = ('titulo', 'editor', 'fecha_publicacion')
  list_filter = ('fecha_publicacion',)
  date_hierarchy = 'fecha_publicacion'
  ordering = ('-fecha_publicacion',)
  filter_horizontal = ('autores',)
```

Para campos ForeignKey, con multiples objetos, esto debido al alto
tiempo de carga de la página se recomienda usar la variable
raw_id_fields

``` python
class LibroAdmin(admin.ModelAdmin):
  list_display = ('titulo', 'editor', 'fecha_publicacion')
  list_filter = ('fecha_publicacion',)
  date_hierarchy = 'fecha_publicacion'
  ordering = ('-fecha_publicacion',)
  filter_horizontal = ('autores',)
  raw_id_fields = ('editor',)
```

### 1.5.5 Personalizar la apariencia de la interfaz de administración

Puedes colocar el titulo del sitio de administración agregando la
variable admin.site.site_header a *urls.py*

``` python
admin.site.site_header = 'Nombre de mi sitio'
admin.site.index_title = 'Panel de control de mi sitio'
admin.site.site_title = 'Titulo en la pestaña del navegador'
```

Copia la plantilla que se encuentra en django/contrib/admin/templates
dentro de un directorio llamado admin que se encuentre dentro de la ruta
a la que apunta la variable TEMPLATE en *settings.py*

### 1.5.6 Usuarios, Grupos y Permisos

En los usuarios hay 3 opciones: \* Activo: Si está desactivada el
usuario no tendrá acceso a ninguna URL que requiera identificación. \*
Es staff: Si está activada permite el ingreso al sitio administrativo
para ese usuario \* Es superusuario: da al usuario completo e
irrestricto acceso a todos los elementos de la interfaz de
administración, y sus permisos regulares son ignorados.

La lista de permisos detallada se encuentra más abajo de cada usuario Si
le das a alguien el permiso de editar usuarios, estará en condiciones de
editar sus propios permisos. También puedes asignar usuarios a grupos.
Un grupo es simplemente un conjunto de permisos a aplicar a todos los
usuarios de ese grupo.

